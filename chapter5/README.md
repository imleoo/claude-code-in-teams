# ç¬¬5ç« ï¼šå®æˆ˜æ¡ˆä¾‹ - æ™ºèƒ½å®¢æœç³»ç»Ÿå¼€å‘

## ğŸ“‹ æœ¬ç« ç›®å½•

- [ğŸ“– ç« èŠ‚æ¦‚è¿°](#ç« èŠ‚æ¦‚è¿°)
- [ğŸ¯ é¡¹ç›®èƒŒæ™¯ä¸éœ€æ±‚åˆ†æ](#é¡¹ç›®èƒŒæ™¯ä¸éœ€æ±‚åˆ†æ)

## ğŸ“„ ç« èŠ‚æ–‡ä»¶å¯¼èˆª

- [å®Œæ•´æ¡ˆä¾‹å®æ–½æŒ‡å—](./case-study-implementation.md) - æ™ºèƒ½å®¢æœç³»ç»Ÿå¼€å‘çš„å®Œæ•´å®æ–½æŒ‡å—ï¼ŒåŒ…å«é¡¹ç›®èƒŒæ™¯ã€éœ€æ±‚åˆ†æã€æŠ€æœ¯æ¶æ„ã€å¼€å‘æµç¨‹å’Œæœ€ä½³å®è·µ

## ğŸ”— ç« èŠ‚å¯¼èˆª

â† [ä¸Šä¸€ç« ï¼šå¤šæ™ºèƒ½ä½“åä½œæ¨¡å¼](../chapter4/README.md) | [è¿”å›ä¸»ç›®å½•](../README.md) | [ä¸‹ä¸€ç« ï¼šæœ€ä½³å®è·µä¸æœªæ¥å±•æœ›](../chapter6/README.md) â†’

---

## ç« èŠ‚æ¦‚è¿°

æœ¬ç« å°†é€šè¿‡ä¸€ä¸ªå®Œæ•´çš„æ™ºèƒ½å®¢æœç³»ç»Ÿå¼€å‘æ¡ˆä¾‹ï¼Œå±•ç¤ºTeam Vibe Codingåœ¨å®é™…é¡¹ç›®ä¸­çš„åº”ç”¨ã€‚æˆ‘ä»¬å°†ä»é¡¹ç›®å¯åŠ¨åˆ°éƒ¨ç½²ä¸Šçº¿ï¼Œå®Œæ•´æ¼”ç¤ºå¤šæ™ºèƒ½ä½“åä½œã€å¹¶è¡Œå¼€å‘ã€ä»£ç è¯„å®¡å’Œæµ‹è¯•çš„å…¨æµç¨‹å®è·µã€‚

## é¡¹ç›®èƒŒæ™¯ä¸éœ€æ±‚åˆ†æ

### ä¸šåŠ¡èƒŒæ™¯

æŸç”µå•†å¹³å°é¢ä¸´å®¢æœå‹åŠ›æ—¥ç›Šå¢é•¿çš„æŒ‘æˆ˜ï¼š
- æ—¥å‡å®¢æœå’¨è¯¢é‡è¶…è¿‡10ä¸‡æ¬¡
- äººå·¥å®¢æœæˆæœ¬æŒç»­ä¸Šå‡
- å®¢æˆ·ç­‰å¾…æ—¶é—´è¿‡é•¿ï¼Œæ»¡æ„åº¦ä¸‹é™
- é‡å¤æ€§é—®é¢˜å æ¯”è¶…è¿‡70%

### é¡¹ç›®ç›®æ ‡

**æ ¸å¿ƒç›®æ ‡**
- æ„å»ºæ™ºèƒ½å®¢æœç³»ç»Ÿï¼Œè‡ªåŠ¨å¤„ç†å¸¸è§é—®é¢˜
- æå‡å®¢æˆ·æœåŠ¡æ•ˆç‡ï¼Œå‡å°‘ç­‰å¾…æ—¶é—´
- é™ä½äººå·¥å®¢æœæˆæœ¬ï¼Œä¼˜åŒ–èµ„æºé…ç½®
- æä¾›7Ã—24å°æ—¶ä¸é—´æ–­æœåŠ¡

**æŠ€æœ¯ç›®æ ‡**
- ç³»ç»Ÿå“åº”æ—¶é—´ < 2ç§’
- æ„å›¾è¯†åˆ«å‡†ç¡®ç‡ > 85%
- æ”¯æŒå¹¶å‘ç”¨æˆ· > 1000
- ç³»ç»Ÿå¯ç”¨æ€§ > 99.9%

### éœ€æ±‚åˆ†æ

#### 1. åŠŸèƒ½éœ€æ±‚

**ç”¨æˆ·ç«¯åŠŸèƒ½**
```yaml
ç”¨æˆ·åŠŸèƒ½éœ€æ±‚:
  å¯¹è¯äº¤äº’:
    - è‡ªç„¶è¯­è¨€å¯¹è¯
    - å¤šè½®å¯¹è¯æ”¯æŒ
    - ä¸Šä¸‹æ–‡ç†è§£
    - æƒ…æ„Ÿè¯†åˆ«
  
  é—®é¢˜è§£å†³:
    - è®¢å•æŸ¥è¯¢
    - é€€æ¢è´§å¤„ç†
    - äº§å“å’¨è¯¢
    - è´¦æˆ·é—®é¢˜
  
  ç”¨æˆ·ä½“éªŒ:
    - å¿«é€Ÿå“åº”
    - å‡†ç¡®ç†è§£
    - å‹å¥½äº¤äº’
    - æ— ç¼è½¬äººå·¥
```

**ç®¡ç†ç«¯åŠŸèƒ½**
```yaml
ç®¡ç†åŠŸèƒ½éœ€æ±‚:
  çŸ¥è¯†åº“ç®¡ç†:
    - çŸ¥è¯†æ¡ç›®å¢åˆ æ”¹æŸ¥
    - åˆ†ç±»ç®¡ç†
    - æœç´¢ä¼˜åŒ–
    - ç‰ˆæœ¬æ§åˆ¶
  
  å¯¹è¯ç›‘æ§:
    - å®æ—¶å¯¹è¯ç›‘æ§
    - è´¨é‡è¯„ä¼°
    - å¼‚å¸¸å‘Šè­¦
    - æ•°æ®ç»Ÿè®¡
  
  ç³»ç»Ÿé…ç½®:
    - æ„å›¾æ¨¡å‹è®­ç»ƒ
    - å›å¤æ¨¡æ¿ç®¡ç†
    - è½¬äººå·¥è§„åˆ™
    - ç³»ç»Ÿå‚æ•°é…ç½®
```

#### 2. éåŠŸèƒ½éœ€æ±‚

**æ€§èƒ½éœ€æ±‚**
- å“åº”æ—¶é—´ï¼šå¹³å‡ < 2ç§’ï¼ŒP99 < 5ç§’
- ååé‡ï¼šæ”¯æŒ1000+ QPS
- å¹¶å‘ç”¨æˆ·ï¼šæ”¯æŒ10000+åœ¨çº¿ç”¨æˆ·
- å¯ç”¨æ€§ï¼š99.9%ç³»ç»Ÿå¯ç”¨æ€§

**å®‰å…¨éœ€æ±‚**
- ç”¨æˆ·æ•°æ®åŠ å¯†å­˜å‚¨
- APIæ¥å£å®‰å…¨è®¤è¯
- æ•æ„Ÿä¿¡æ¯è„±æ•
- è®¿é—®æƒé™æ§åˆ¶

**æ‰©å±•æ€§éœ€æ±‚**
- æ°´å¹³æ‰©å±•æ”¯æŒ
- å¾®æœåŠ¡æ¶æ„
- å®¹å™¨åŒ–éƒ¨ç½²
- äº‘åŸç”Ÿæ”¯æŒ

## ç³»ç»Ÿæ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„

```mermaid
graph TB
    subgraph "ç”¨æˆ·å±‚"
        A[Webå®¢æˆ·ç«¯]
        B[ç§»åŠ¨ç«¯APP]
        C[ç¬¬ä¸‰æ–¹é›†æˆ]
    end
    
    subgraph "æ¥å…¥å±‚"
        D[APIç½‘å…³]
        E[è´Ÿè½½å‡è¡¡å™¨]
    end
    
    subgraph "åº”ç”¨å±‚"
        F[ç”¨æˆ·æœåŠ¡]
        G[å¯¹è¯æœåŠ¡]
        H[æ„å›¾è¯†åˆ«æœåŠ¡]
        I[çŸ¥è¯†åº“æœåŠ¡]
        J[ç®¡ç†æœåŠ¡]
    end
    
    subgraph "æ•°æ®å±‚"
        K[ç”¨æˆ·æ•°æ®åº“]
        L[å¯¹è¯æ•°æ®åº“]
        M[çŸ¥è¯†åº“]
        N[ç¼“å­˜å±‚]
    end
    
    subgraph "AIå±‚"
        O[NLPæ¨¡å‹]
        P[æ„å›¾åˆ†ç±»å™¨]
        Q[å®ä½“è¯†åˆ«å™¨]
        R[æƒ…æ„Ÿåˆ†æå™¨]
    end
    
    A --> D
    B --> D
    C --> D
    D --> E
    E --> F
    E --> G
    E --> H
    E --> I
    E --> J
    
    F --> K
    G --> L
    G --> N
    H --> O
    H --> P
    I --> M
    
    H --> Q
    H --> R
```

### æŠ€æœ¯æ ˆé€‰æ‹©

**åç«¯æŠ€æœ¯æ ˆ**
```yaml
æŠ€æœ¯æ ˆé€‰æ‹©:
  è¿è¡Œæ—¶: Node.js 18 LTS
  æ¡†æ¶: Express.js + TypeScript
  æ•°æ®åº“: 
    - MongoDB (ç”¨æˆ·æ•°æ®ã€å¯¹è¯è®°å½•)
    - Elasticsearch (çŸ¥è¯†åº“æœç´¢)
    - Redis (ç¼“å­˜ã€ä¼šè¯)
  
  AI/ML:
    - Python + FastAPI (AIæœåŠ¡)
    - Transformers (é¢„è®­ç»ƒæ¨¡å‹)
    - scikit-learn (ä¼ ç»ŸML)
  
  æ¶ˆæ¯é˜Ÿåˆ—: Redis + Bull
  ç›‘æ§: Prometheus + Grafana
  æ—¥å¿—: Winston + ELK Stack
```

**å‰ç«¯æŠ€æœ¯æ ˆ**
```yaml
å‰ç«¯æŠ€æœ¯æ ˆ:
  æ¡†æ¶: React 18 + TypeScript
  çŠ¶æ€ç®¡ç†: Redux Toolkit
  UIç»„ä»¶: Ant Design
  æ„å»ºå·¥å…·: Vite
  æµ‹è¯•: Jest + React Testing Library
```

### æ•°æ®æ¨¡å‹è®¾è®¡

#### 1. ç”¨æˆ·æ•°æ®æ¨¡å‹

```typescript
// ç”¨æˆ·æ•°æ®æ¨¡å‹
interface User {
  id: string;
  email: string;
  name: string;
  avatar?: string;
  role: 'customer' | 'agent' | 'admin';
  preferences: {
    language: string;
    timezone: string;
    notifications: boolean;
  };
  createdAt: Date;
  updatedAt: Date;
  lastLoginAt?: Date;
}

// ç”¨æˆ·ä¼šè¯æ¨¡å‹
interface UserSession {
  id: string;
  userId: string;
  sessionToken: string;
  expiresAt: Date;
  deviceInfo: {
    userAgent: string;
    ip: string;
    platform: string;
  };
  createdAt: Date;
}
```

#### 2. å¯¹è¯æ•°æ®æ¨¡å‹

```typescript
// å¯¹è¯ä¼šè¯æ¨¡å‹
interface DialogSession {
  id: string;
  userId: string;
  type: 'customer-service' | 'sales' | 'technical';
  status: 'active' | 'ended' | 'transferred';
  context: {
    userInfo: Partial<User>;
    previousSessions: string[];
    currentTopic?: string;
  };
  metadata: {
    channel: 'web' | 'mobile' | 'api';
    startTime: Date;
    endTime?: Date;
    duration?: number;
    satisfaction?: number;
  };
  createdAt: Date;
  updatedAt: Date;
}

// æ¶ˆæ¯æ¨¡å‹
interface Message {
  id: string;
  sessionId: string;
  sender: 'user' | 'bot' | 'agent';
  content: {
    text: string;
    type: 'text' | 'image' | 'file' | 'quick-reply';
    metadata?: Record<string, any>;
  };
  intent?: {
    name: string;
    confidence: number;
    entities: Entity[];
  };
  response?: {
    text: string;
    suggestions?: string[];
    actions?: Action[];
  };
  timestamp: Date;
}

// å®ä½“æ¨¡å‹
interface Entity {
  type: string;
  value: string;
  confidence: number;
  start: number;
  end: number;
}

// åŠ¨ä½œæ¨¡å‹
interface Action {
  type: 'redirect' | 'form' | 'transfer' | 'escalate';
  data: Record<string, any>;
}
```

#### 3. çŸ¥è¯†åº“æ•°æ®æ¨¡å‹

```typescript
// çŸ¥è¯†åº“æ–‡ç« æ¨¡å‹
interface KnowledgeArticle {
  id: string;
  title: string;
  content: string;
  summary: string;
  category: string;
  tags: string[];
  keywords: string[];
  priority: 'low' | 'medium' | 'high';
  status: 'draft' | 'published' | 'archived';
  author: {
    id: string;
    name: string;
  };
  metadata: {
    views: number;
    likes: number;
    effectiveness: number;
    lastUsed?: Date;
  };
  createdAt: Date;
  updatedAt: Date;
  publishedAt?: Date;
}

// çŸ¥è¯†åº“åˆ†ç±»æ¨¡å‹
interface KnowledgeCategory {
  id: string;
  name: string;
  description: string;
  parentId?: string;
  children: string[];
  articleCount: number;
  order: number;
  createdAt: Date;
  updatedAt: Date;
}
```

## Team Vibe Codingå®æ–½

### æ™ºèƒ½ä½“è§’è‰²åˆ†é…

#### 1. éœ€æ±‚åˆ†ææ™ºèƒ½ä½“

**èŒè´£å®šä¹‰**
```yaml
éœ€æ±‚åˆ†ææ™ºèƒ½ä½“é…ç½®:
  åç§°: RequirementsAnalyst
  ä¸“ä¸šé¢†åŸŸ: 
    - ä¸šåŠ¡éœ€æ±‚åˆ†æ
    - ç”¨æˆ·æ•…äº‹ç¼–å†™
    - éªŒæ”¶æ ‡å‡†å®šä¹‰
    - éœ€æ±‚ä¼˜å…ˆçº§è¯„ä¼°
  
  å·¥ä½œæµç¨‹:
    è¾“å…¥: åŸå§‹ä¸šåŠ¡éœ€æ±‚æ–‡æ¡£
    å¤„ç†: 
      - éœ€æ±‚è§£æå’Œç»“æ„åŒ–
      - ä¸šåŠ¡è§„åˆ™æå–
      - ç”¨æˆ·æ•…äº‹ç”Ÿæˆ
      - éªŒæ”¶æ ‡å‡†å®šä¹‰
    è¾“å‡º: ç»“æ„åŒ–éœ€æ±‚æ–‡æ¡£
  
  è´¨é‡æ ‡å‡†:
    - éœ€æ±‚è¦†ç›–åº¦ > 95%
    - ç”¨æˆ·æ•…äº‹å®Œæ•´æ€§æ£€æŸ¥
    - éªŒæ”¶æ ‡å‡†å¯æµ‹è¯•æ€§éªŒè¯
```

**å®é™…å·¥ä½œç¤ºä¾‹**
```markdown
# æ™ºèƒ½å®¢æœç³»ç»Ÿéœ€æ±‚åˆ†ææŠ¥å‘Š

## æ ¸å¿ƒç”¨æˆ·æ•…äº‹

### ç”¨æˆ·æ•…äº‹ 1: åŸºç¡€å¯¹è¯åŠŸèƒ½
**ä½œä¸º** ç”µå•†å¹³å°çš„å®¢æˆ·
**æˆ‘å¸Œæœ›** èƒ½å¤Ÿé€šè¿‡è‡ªç„¶è¯­è¨€ä¸å®¢æœç³»ç»Ÿå¯¹è¯
**ä»¥ä¾¿äº** å¿«é€Ÿè·å¾—é—®é¢˜è§£ç­”

**éªŒæ”¶æ ‡å‡†:**
- [ ] ç”¨æˆ·å¯ä»¥è¾“å…¥è‡ªç„¶è¯­è¨€é—®é¢˜
- [ ] ç³»ç»Ÿèƒ½å¤Ÿç†è§£ç”¨æˆ·æ„å›¾ï¼ˆå‡†ç¡®ç‡ > 85%ï¼‰
- [ ] ç³»ç»Ÿåœ¨2ç§’å†…ç»™å‡ºå›å¤
- [ ] æ”¯æŒå¤šè½®å¯¹è¯ä¸Šä¸‹æ–‡ç†è§£

### ç”¨æˆ·æ•…äº‹ 2: è®¢å•æŸ¥è¯¢åŠŸèƒ½
**ä½œä¸º** å·²è´­ä¹°å•†å“çš„å®¢æˆ·
**æˆ‘å¸Œæœ›** èƒ½å¤ŸæŸ¥è¯¢æˆ‘çš„è®¢å•çŠ¶æ€
**ä»¥ä¾¿äº** äº†è§£å•†å“é…é€è¿›åº¦

**éªŒæ”¶æ ‡å‡†:**
- [ ] ç”¨æˆ·å¯ä»¥é€šè¿‡è®¢å•å·æŸ¥è¯¢çŠ¶æ€
- [ ] ç³»ç»Ÿæ˜¾ç¤ºè¯¦ç»†çš„ç‰©æµä¿¡æ¯
- [ ] æ”¯æŒæ¨¡ç³ŠæŸ¥è¯¢ï¼ˆå•†å“åç§°ã€æ—¶é—´èŒƒå›´ï¼‰
- [ ] æŸ¥è¯¢ç»“æœå‡†ç¡®ç‡ > 99%

### ç”¨æˆ·æ•…äº‹ 3: çŸ¥è¯†åº“ç®¡ç†
**ä½œä¸º** å®¢æœç®¡ç†å‘˜
**æˆ‘å¸Œæœ›** èƒ½å¤Ÿç®¡ç†çŸ¥è¯†åº“å†…å®¹
**ä»¥ä¾¿äº** æå‡å®¢æœç³»ç»Ÿçš„å›ç­”è´¨é‡

**éªŒæ”¶æ ‡å‡†:**
- [ ] æ”¯æŒçŸ¥è¯†æ¡ç›®çš„å¢åˆ æ”¹æŸ¥
- [ ] æä¾›åˆ†ç±»ç®¡ç†åŠŸèƒ½
- [ ] æ”¯æŒæ‰¹é‡å¯¼å…¥å¯¼å‡º
- [ ] æä¾›æœç´¢å’Œç­›é€‰åŠŸèƒ½
```

#### 2. æ¶æ„è®¾è®¡æ™ºèƒ½ä½“

**æ¶æ„è®¾è®¡è¾“å‡º**
```yaml
# æ™ºèƒ½å®¢æœç³»ç»Ÿæ¶æ„è®¾è®¡

ç³»ç»Ÿæ¶æ„æ¨¡å¼: å¾®æœåŠ¡æ¶æ„ + äº‹ä»¶é©±åŠ¨

æ ¸å¿ƒæœåŠ¡è®¾è®¡:
  ç”¨æˆ·æœåŠ¡ (User Service):
    èŒè´£: ç”¨æˆ·è®¤è¯ã€æˆæƒã€ä¸ªäººä¿¡æ¯ç®¡ç†
    æŠ€æœ¯æ ˆ: Node.js + Express + MongoDB
    æ¥å£: RESTful API
    
  å¯¹è¯æœåŠ¡ (Dialog Service):
    èŒè´£: å¯¹è¯ä¼šè¯ç®¡ç†ã€æ¶ˆæ¯è·¯ç”±ã€ä¸Šä¸‹æ–‡ç»´æŠ¤
    æŠ€æœ¯æ ˆ: Node.js + Express + Redis
    æ¥å£: RESTful API + WebSocket
    
  æ„å›¾è¯†åˆ«æœåŠ¡ (Intent Service):
    èŒè´£: è‡ªç„¶è¯­è¨€ç†è§£ã€æ„å›¾åˆ†ç±»ã€å®ä½“æå–
    æŠ€æœ¯æ ˆ: Python + FastAPI + Transformers
    æ¥å£: gRPC
    
  çŸ¥è¯†åº“æœåŠ¡ (Knowledge Service):
    èŒè´£: çŸ¥è¯†æ£€ç´¢ã€å†…å®¹ç®¡ç†ã€æœç´¢ä¼˜åŒ–
    æŠ€æœ¯æ ˆ: Node.js + Express + Elasticsearch
    æ¥å£: RESTful API

æ•°æ®æµè®¾è®¡:
  ç”¨æˆ·è¾“å…¥ â†’ APIç½‘å…³ â†’ å¯¹è¯æœåŠ¡ â†’ æ„å›¾è¯†åˆ« â†’ çŸ¥è¯†æ£€ç´¢ â†’ å“åº”ç”Ÿæˆ â†’ ç”¨æˆ·è¾“å‡º

æ€§èƒ½è®¾è®¡:
  ç¼“å­˜ç­–ç•¥: Rediså¤šå±‚ç¼“å­˜
  è´Ÿè½½å‡è¡¡: Nginx + è½®è¯¢ç®—æ³•
  æ•°æ®åº“ä¼˜åŒ–: è¯»å†™åˆ†ç¦» + ç´¢å¼•ä¼˜åŒ–
  å¼‚æ­¥å¤„ç†: æ¶ˆæ¯é˜Ÿåˆ— + äº‹ä»¶é©±åŠ¨

å®‰å…¨è®¾è®¡:
  è®¤è¯: JWT + OAuth2
  æˆæƒ: RBACæƒé™æ¨¡å‹
  æ•°æ®åŠ å¯†: AES-256 + HTTPS
  APIå®‰å…¨: é™æµ + é˜²æŠ¤
```

#### 3. ä»£ç ç”Ÿæˆæ™ºèƒ½ä½“

**ä»£ç ç”Ÿæˆç­–ç•¥**
```javascript
// ä»£ç ç”Ÿæˆæ™ºèƒ½ä½“é…ç½®
const codeGeneratorConfig = {
  // ä»£ç æ¨¡æ¿åº“
  templates: {
    controller: 'express-controller-template',
    service: 'business-service-template',
    model: 'mongoose-model-template',
    middleware: 'express-middleware-template',
    test: 'jest-test-template'
  },
  
  // ä»£ç è§„èŒƒ
  conventions: {
    naming: 'camelCase',
    fileNaming: 'kebab-case',
    indentation: 2,
    quotes: 'single',
    semicolons: true
  },
  
  // è‡ªåŠ¨ç”Ÿæˆè§„åˆ™
  autoGeneration: {
    imports: true,
    exports: true,
    documentation: true,
    tests: true,
    validation: true
  }
};

// è‡ªåŠ¨ç”Ÿæˆçš„æ§åˆ¶å™¨ç¤ºä¾‹
class DialogController {
  constructor(dialogService, intentService, knowledgeService, logger) {
    this.dialogService = dialogService;
    this.intentService = intentService;
    this.knowledgeService = knowledgeService;
    this.logger = logger;
  }

  /**
   * åˆ›å»ºæ–°çš„å¯¹è¯ä¼šè¯
   * @param {Object} req - Expressè¯·æ±‚å¯¹è±¡
   * @param {Object} res - Expresså“åº”å¯¹è±¡
   */
  async createSession(req, res) {
    try {
      const { userId, type = 'customer-service' } = req.body;
      
      // å‚æ•°éªŒè¯
      if (!userId) {
        return res.status(400).json({
          success: false,
          error: 'User ID is required'
        });
      }

      // åˆ›å»ºä¼šè¯
      const session = await this.dialogService.createSession({
        userId,
        type,
        context: {
          userInfo: req.user,
          channel: req.headers['x-channel'] || 'web'
        }
      });

      this.logger.info('Dialog session created', {
        sessionId: session.id,
        userId,
        type
      });

      return res.status(201).json({
        success: true,
        data: session
      });

    } catch (error) {
      this.logger.error('Failed to create dialog session', {
        error: error.message,
        userId: req.body.userId
      });

      return res.status(500).json({
        success: false,
        error: 'Internal server error'
      });
    }
  }

  /**
   * å¤„ç†ç”¨æˆ·æ¶ˆæ¯
   * @param {Object} req - Expressè¯·æ±‚å¯¹è±¡
   * @param {Object} res - Expresså“åº”å¯¹è±¡
   */
  async handleMessage(req, res) {
    try {
      const { sessionId, message } = req.body;
      
      // å‚æ•°éªŒè¯
      if (!sessionId || !message) {
        return res.status(400).json({
          success: false,
          error: 'Session ID and message are required'
        });
      }

      // è·å–ä¼šè¯ä¸Šä¸‹æ–‡
      const session = await this.dialogService.getSession(sessionId);
      if (!session) {
        return res.status(404).json({
          success: false,
          error: 'Session not found'
        });
      }

      // æ„å›¾è¯†åˆ«
      const intent = await this.intentService.analyze({
        text: message,
        context: session.context,
        history: session.history
      });

      // çŸ¥è¯†æ£€ç´¢
      const knowledge = await this.knowledgeService.search({
        intent: intent.name,
        entities: intent.entities,
        context: session.context
      });

      // ç”Ÿæˆå“åº”
      const response = await this.dialogService.generateResponse({
        message,
        intent,
        knowledge,
        session
      });

      // æ›´æ–°ä¼šè¯
      await this.dialogService.updateSession(sessionId, {
        lastMessage: message,
        lastResponse: response.text,
        lastIntent: intent
      });

      this.logger.info('Message processed successfully', {
        sessionId,
        intent: intent.name,
        confidence: intent.confidence
      });

      return res.json({
        success: true,
        data: {
          response: response.text,
          suggestions: response.suggestions,
          actions: response.actions,
          sessionId
        }
      });

    } catch (error) {
      this.logger.error('Failed to process message', {
        error: error.message,
        sessionId: req.body.sessionId
      });

      return res.status(500).json({
        success: false,
        error: 'Internal server error'
      });
    }
  }
}

module.exports = DialogController;
```

#### 4. æµ‹è¯•å·¥ç¨‹æ™ºèƒ½ä½“

**æµ‹è¯•ç­–ç•¥è®¾è®¡**
```javascript
// æµ‹è¯•å·¥ç¨‹æ™ºèƒ½ä½“é…ç½®
const testEngineerConfig = {
  // æµ‹è¯•ç­–ç•¥
  strategy: {
    unitTests: {
      coverage: 90,
      frameworks: ['jest', 'mocha'],
      mocking: 'comprehensive'
    },
    integrationTests: {
      coverage: 80,
      scenarios: 'business-critical',
      environment: 'isolated'
    },
    e2eTests: {
      coverage: 'user-journeys',
      tools: ['cypress', 'playwright'],
      environments: ['staging', 'production']
    }
  },
  
  // è‡ªåŠ¨ç”Ÿæˆè§„åˆ™
  autoGeneration: {
    unitTests: true,
    mocks: true,
    fixtures: true,
    assertions: true
  }
};

// è‡ªåŠ¨ç”Ÿæˆçš„æµ‹è¯•ç”¨ä¾‹
describe('DialogController', () => {
  let controller;
  let mockDialogService;
  let mockIntentService;
  let mockKnowledgeService;
  let mockLogger;

  beforeEach(() => {
    // åˆ›å»ºMockå¯¹è±¡
    mockDialogService = {
      createSession: jest.fn(),
      getSession: jest.fn(),
      updateSession: jest.fn(),
      generateResponse: jest.fn()
    };

    mockIntentService = {
      analyze: jest.fn()
    };

    mockKnowledgeService = {
      search: jest.fn()
    };

    mockLogger = {
      info: jest.fn(),
      error: jest.fn()
    };

    controller = new DialogController(
      mockDialogService,
      mockIntentService,
      mockKnowledgeService,
      mockLogger
    );
  });

  describe('createSession', () => {
    it('åº”è¯¥æˆåŠŸåˆ›å»ºå¯¹è¯ä¼šè¯', async () => {
      // å‡†å¤‡æµ‹è¯•æ•°æ®
      const req = {
        body: { userId: 'user-123', type: 'customer-service' },
        user: { id: 'user-123', name: 'Test User' },
        headers: { 'x-channel': 'web' }
      };
      const res = {
        status: jest.fn().mockReturnThis(),
        json: jest.fn()
      };

      const mockSession = {
        id: 'session-456',
        userId: 'user-123',
        type: 'customer-service',
        createdAt: new Date()
      };

      mockDialogService.createSession.mockResolvedValue(mockSession);

      // æ‰§è¡Œæµ‹è¯•
      await controller.createSession(req, res);

      // éªŒè¯ç»“æœ
      expect(mockDialogService.createSession).toHaveBeenCalledWith({
        userId: 'user-123',
        type: 'customer-service',
        context: {
          userInfo: req.user,
          channel: 'web'
        }
      });

      expect(res.status).toHaveBeenCalledWith(201);
      expect(res.json).toHaveBeenCalledWith({
        success: true,
        data: mockSession
      });

      expect(mockLogger.info).toHaveBeenCalledWith(
        'Dialog session created',
        expect.objectContaining({
          sessionId: 'session-456',
          userId: 'user-123',
          type: 'customer-service'
        })
      );
    });

    it('åº”è¯¥å¤„ç†ç¼ºå°‘userIdçš„æƒ…å†µ', async () => {
      const req = { body: {}, headers: {} };
      const res = {
        status: jest.fn().mockReturnThis(),
        json: jest.fn()
      };

      await controller.createSession(req, res);

      expect(res.status).toHaveBeenCalledWith(400);
      expect(res.json).toHaveBeenCalledWith({
        success: false,
        error: 'User ID is required'
      });
    });
  });

  describe('handleMessage', () => {
    it('åº”è¯¥æˆåŠŸå¤„ç†ç”¨æˆ·æ¶ˆæ¯', async () => {
      // å‡†å¤‡æµ‹è¯•æ•°æ®
      const req = {
        body: {
          sessionId: 'session-456',
          message: 'æˆ‘æƒ³æŸ¥è¯¢è®¢å•çŠ¶æ€'
        }
      };
      const res = {
        status: jest.fn().mockReturnThis(),
        json: jest.fn()
      };

      const mockSession = {
        id: 'session-456',
        context: { userId: 'user-123' },
        history: []
      };

      const mockIntent = {
        name: 'order_inquiry',
        confidence: 0.95,
        entities: [{ type: 'order_id', value: '12345' }]
      };

      const mockKnowledge = [
        { content: 'æ‚¨å¯ä»¥é€šè¿‡è®¢å•å·æŸ¥è¯¢è®¢å•çŠ¶æ€' }
      ];

      const mockResponse = {
        text: 'è¯·æä¾›æ‚¨çš„è®¢å•å·ï¼Œæˆ‘æ¥å¸®æ‚¨æŸ¥è¯¢è®¢å•çŠ¶æ€',
        suggestions: ['è¾“å…¥è®¢å•å·', 'è”ç³»äººå·¥å®¢æœ'],
        actions: []
      };

      // è®¾ç½®Mockè¿”å›å€¼
      mockDialogService.getSession.mockResolvedValue(mockSession);
      mockIntentService.analyze.mockResolvedValue(mockIntent);
      mockKnowledgeService.search.mockResolvedValue(mockKnowledge);
      mockDialogService.generateResponse.mockResolvedValue(mockResponse);
      mockDialogService.updateSession.mockResolvedValue(true);

      // æ‰§è¡Œæµ‹è¯•
      await controller.handleMessage(req, res);

      // éªŒè¯ç»“æœ
      expect(mockDialogService.getSession).toHaveBeenCalledWith('session-456');
      expect(mockIntentService.analyze).toHaveBeenCalledWith({
        text: 'æˆ‘æƒ³æŸ¥è¯¢è®¢å•çŠ¶æ€',
        context: mockSession.context,
        history: mockSession.history
      });

      expect(res.json).toHaveBeenCalledWith({
        success: true,
        data: {
          response: mockResponse.text,
          suggestions: mockResponse.suggestions,
          actions: mockResponse.actions,
          sessionId: 'session-456'
        }
      });
    });
  });
});
```

### å¹¶è¡Œå¼€å‘å®æ–½

#### 1. åŠŸèƒ½æ¨¡å—åˆ†è§£

**æ¨¡å—å¹¶è¡ŒåŒ–ç­–ç•¥**
```yaml
å¹¶è¡Œå¼€å‘è®¡åˆ’:
  æ™ºèƒ½å®¢æœç³»ç»Ÿ:
    é˜¶æ®µä¸€ (åŸºç¡€è®¾æ–½):
      - ç”¨æˆ·è®¤è¯æ¨¡å—
        è´Ÿè´£äºº: å¼ ä¸‰
        å·¥ä½œæ ‘: feature/user-auth
        é¢„è®¡æ—¶é—´: 3å¤©
        ä¾èµ–: æ— 
        
      - APIç½‘å…³é…ç½®
        è´Ÿè´£äºº: æå››
        å·¥ä½œæ ‘: feature/api-gateway
        é¢„è®¡æ—¶é—´: 2å¤©
        ä¾èµ–: æ— 
        
      - æ•°æ®åº“è®¾è®¡
        è´Ÿè´£äºº: ç‹äº”
        å·¥ä½œæ ‘: feature/database-schema
        é¢„è®¡æ—¶é—´: 2å¤©
        ä¾èµ–: æ— 
    
    é˜¶æ®µäºŒ (æ ¸å¿ƒæœåŠ¡):
      - å¯¹è¯æœåŠ¡
        è´Ÿè´£äºº: å¼ ä¸‰
        å·¥ä½œæ ‘: feature/dialog-service
        é¢„è®¡æ—¶é—´: 5å¤©
        ä¾èµ–: ç”¨æˆ·è®¤è¯æ¨¡å—
        
      - æ„å›¾è¯†åˆ«æœåŠ¡
        è´Ÿè´£äºº: èµµå…­
        å·¥ä½œæ ‘: feature/intent-service
        é¢„è®¡æ—¶é—´: 6å¤©
        ä¾èµ–: æ— 
        
      - çŸ¥è¯†åº“æœåŠ¡
        è´Ÿè´£äºº: ç‹äº”
        å·¥ä½œæ ‘: feature/knowledge-service
        é¢„è®¡æ—¶é—´: 4å¤©
        ä¾èµ–: æ•°æ®åº“è®¾è®¡
    
    é˜¶æ®µä¸‰ (é›†æˆä¼˜åŒ–):
      - æœåŠ¡é›†æˆ
        è´Ÿè´£äºº: å…¨å‘˜
        å·¥ä½œæ ‘: feature/integration
        é¢„è®¡æ—¶é—´: 3å¤©
        ä¾èµ–: æ‰€æœ‰æ ¸å¿ƒæœåŠ¡
        
      - æ€§èƒ½ä¼˜åŒ–
        è´Ÿè´£äºº: æå››
        å·¥ä½œæ ‘: feature/performance
        é¢„è®¡æ—¶é—´: 2å¤©
        ä¾èµ–: æœåŠ¡é›†æˆ
```

#### 2. Git Worktreesé…ç½®

**Worktreesç®¡ç†è„šæœ¬**
```bash
#!/bin/bash
# setup-worktrees.sh - æ™ºèƒ½å®¢æœç³»ç»Ÿå·¥ä½œæ ‘é…ç½®

# é¡¹ç›®æ ¹ç›®å½•
PROJECT_ROOT="/workspace/intelligent-customer-service"
cd $PROJECT_ROOT

# åˆ›å»ºåŠŸèƒ½åˆ†æ”¯å·¥ä½œæ ‘
echo "åˆ›å»ºåŠŸèƒ½å¼€å‘å·¥ä½œæ ‘..."

# ç”¨æˆ·è®¤è¯æ¨¡å—
git worktree add ../auth-service feature/user-auth
echo "âœ“ ç”¨æˆ·è®¤è¯æœåŠ¡å·¥ä½œæ ‘å·²åˆ›å»º: ../auth-service"

# APIç½‘å…³
git worktree add ../api-gateway feature/api-gateway
echo "âœ“ APIç½‘å…³å·¥ä½œæ ‘å·²åˆ›å»º: ../api-gateway"

# å¯¹è¯æœåŠ¡
git worktree add ../dialog-service feature/dialog-service
echo "âœ“ å¯¹è¯æœåŠ¡å·¥ä½œæ ‘å·²åˆ›å»º: ../dialog-service"

# æ„å›¾è¯†åˆ«æœåŠ¡
git worktree add ../intent-service feature/intent-service
echo "âœ“ æ„å›¾è¯†åˆ«æœåŠ¡å·¥ä½œæ ‘å·²åˆ›å»º: ../intent-service"

# çŸ¥è¯†åº“æœåŠ¡
git worktree add ../knowledge-service feature/knowledge-service
echo "âœ“ çŸ¥è¯†åº“æœåŠ¡å·¥ä½œæ ‘å·²åˆ›å»º: ../knowledge-service"

# å‰ç«¯åº”ç”¨
git worktree add ../frontend-app feature/frontend-app
echo "âœ“ å‰ç«¯åº”ç”¨å·¥ä½œæ ‘å·²åˆ›å»º: ../frontend-app"

# æ˜¾ç¤ºå·¥ä½œæ ‘çŠ¶æ€
echo -e "\nå½“å‰å·¥ä½œæ ‘çŠ¶æ€:"
git worktree list

# åˆ›å»ºå¼€å‘ç¯å¢ƒé…ç½®
echo -e "\nåˆ›å»ºå¼€å‘ç¯å¢ƒé…ç½®..."
cat > docker-compose.dev.yml << 'EOF'
version: '3.8'

services:
  # ç”¨æˆ·è®¤è¯æœåŠ¡
  auth-service:
    build:
      context: ../auth-service
      dockerfile: Dockerfile.dev
    ports:
      - "3001:3000"
    volumes:
      - ../auth-service:/app
      - /app/node_modules
    environment:
      - NODE_ENV=development
      - DATABASE_URL=mongodb://mongo:27017/auth
    depends_on:
      - mongo
      - redis

  # å¯¹è¯æœåŠ¡
  dialog-service:
    build:
      context: ../dialog-service
      dockerfile: Dockerfile.dev
    ports:
      - "3002:3000"
    volumes:
      - ../dialog-service:/app
      - /app/node_modules
    environment:
      - NODE_ENV=development
      - DATABASE_URL=mongodb://mongo:27017/dialog
      - REDIS_URL=redis://redis:6379
    depends_on:
      - mongo
      - redis

  # æ„å›¾è¯†åˆ«æœåŠ¡
  intent-service:
    build:
      context: ../intent-service
      dockerfile: Dockerfile.dev
    ports:
      - "8001:8000"
    volumes:
      - ../intent-service:/app
    environment:
      - ENVIRONMENT=development
    depends_on:
      - redis

  # çŸ¥è¯†åº“æœåŠ¡
  knowledge-service:
    build:
      context: ../knowledge-service
      dockerfile: Dockerfile.dev
    ports:
      - "3003:3000"
    volumes:
      - ../knowledge-service:/app
      - /app/node_modules
    environment:
      - NODE_ENV=development
      - ELASTICSEARCH_URL=http://elasticsearch:9200
    depends_on:
      - elasticsearch

  # å‰ç«¯åº”ç”¨
  frontend-app:
    build:
      context: ../frontend-app
      dockerfile: Dockerfile.dev
    ports:
      - "3000:3000"
    volumes:
      - ../frontend-app:/app
      - /app/node_modules
    environment:
      - REACT_APP_API_URL=http://localhost:4000

  # APIç½‘å…³
  api-gateway:
    build:
      context: ../api-gateway
      dockerfile: Dockerfile.dev
    ports:
      - "4000:4000"
    volumes:
      - ../api-gateway:/app
      - /app/node_modules
    environment:
      - NODE_ENV=development
      - AUTH_SERVICE_URL=http://auth-service:3000
      - DIALOG_SERVICE_URL=http://dialog-service:3000
      - INTENT_SERVICE_URL=http://intent-service:8000
      - KNOWLEDGE_SERVICE_URL=http://knowledge-service:3000
    depends_on:
      - auth-service
      - dialog-service
      - intent-service
      - knowledge-service

  # æ•°æ®åº“æœåŠ¡
  mongo:
    image: mongo:5.0
    ports:
      - "27017:27017"
    volumes:
      - mongo_data:/data/db

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"

  elasticsearch:
    image: elasticsearch:8.5.0
    ports:
      - "9200:9200"
    environment:
      - discovery.type=single-node
      - xpack.security.enabled=false
    volumes:
      - es_data:/usr/share/elasticsearch/data

volumes:
  mongo_data:
  es_data:
EOF

echo "âœ“ Docker Composeå¼€å‘ç¯å¢ƒé…ç½®å·²åˆ›å»º"

# åˆ›å»ºå¼€å‘å¯åŠ¨è„šæœ¬
cat > start-dev.sh << 'EOF'
#!/bin/bash
echo "å¯åŠ¨æ™ºèƒ½å®¢æœç³»ç»Ÿå¼€å‘ç¯å¢ƒ..."

# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose -f docker-compose.dev.yml up -d

# ç­‰å¾…æœåŠ¡å¯åŠ¨
echo "ç­‰å¾…æœåŠ¡å¯åŠ¨..."
sleep 30

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
echo "æ£€æŸ¥æœåŠ¡çŠ¶æ€:"
curl -s http://localhost:3001/health && echo "âœ“ ç”¨æˆ·è®¤è¯æœåŠ¡æ­£å¸¸"
curl -s http://localhost:3002/health && echo "âœ“ å¯¹è¯æœåŠ¡æ­£å¸¸"
curl -s http://localhost:8001/health && echo "âœ“ æ„å›¾è¯†åˆ«æœåŠ¡æ­£å¸¸"
curl -s http://localhost:3003/health && echo "âœ“ çŸ¥è¯†åº“æœåŠ¡æ­£å¸¸"
curl -s http://localhost:4000/health && echo "âœ“ APIç½‘å…³æ­£å¸¸"
curl -s http://localhost:3000 && echo "âœ“ å‰ç«¯åº”ç”¨æ­£å¸¸"

echo "å¼€å‘ç¯å¢ƒå¯åŠ¨å®Œæˆï¼"
echo "å‰ç«¯åº”ç”¨: http://localhost:3000"
echo "APIç½‘å…³: http://localhost:4000"
EOF

chmod +x start-dev.sh
echo "âœ“ å¼€å‘å¯åŠ¨è„šæœ¬å·²åˆ›å»º"

echo -e "\næ™ºèƒ½å®¢æœç³»ç»Ÿå¹¶è¡Œå¼€å‘ç¯å¢ƒé…ç½®å®Œæˆï¼"
echo "ä½¿ç”¨ ./start-dev.sh å¯åŠ¨å¼€å‘ç¯å¢ƒ"
```

## ç« èŠ‚å¯¼èˆª

### 5.1 é¡¹ç›®èƒŒæ™¯ä¸éœ€æ±‚åˆ†æ
- [ä¸šåŠ¡éœ€æ±‚åˆ†æ](./business-requirements.md)
- [æŠ€æœ¯éœ€æ±‚è§„åˆ’](./technical-requirements.md)
- [ç”¨æˆ·æ•…äº‹ç¼–å†™](./user-stories.md)

### 5.2 ç³»ç»Ÿæ¶æ„è®¾è®¡
- [æ•´ä½“æ¶æ„è®¾è®¡](./system-architecture.md)
- [æŠ€æœ¯æ ˆé€‰æ‹©](./tech-stack.md)
- [æ•°æ®æ¨¡å‹è®¾è®¡](./data-models.md)

### 5.3 Team Vibe Codingå®æ–½
- [æ™ºèƒ½ä½“è§’è‰²åˆ†é…](./agent-roles.md)
- [å¹¶è¡Œå¼€å‘å®æ–½](./parallel-development.md)
- [ä»£ç è¯„å®¡æµç¨‹](./code-review.md)

### 5.4 æ ¸å¿ƒåŠŸèƒ½å¼€å‘
- [ç”¨æˆ·è®¤è¯æœåŠ¡](./auth-service.md)
- [å¯¹è¯ç®¡ç†æœåŠ¡](./dialog-service.md)
- [æ„å›¾è¯†åˆ«æœåŠ¡](./intent-service.md)
- [çŸ¥è¯†åº“æœåŠ¡](./knowledge-service.md)

### 5.5 é›†æˆæµ‹è¯•ä¸éƒ¨ç½²
- [é›†æˆæµ‹è¯•ç­–ç•¥](./integration-testing.md)
- [æ€§èƒ½æµ‹è¯•å®æ–½](./performance-testing.md)
- [éƒ¨ç½²ä¸ç›‘æ§](./deployment.md)

---

**ä¸‹ä¸€ç« èŠ‚**: [ç¬¬6ç« ï¼šæœ€ä½³å®è·µä¸æœªæ¥å±•æœ›](../chapter6/README.md)

**ä¸Šä¸€ç« èŠ‚**: [ç¬¬4ç« ï¼šå›¢é˜Ÿåä½œæ ¸å¿ƒæµç¨‹](../chapter4/README.md)